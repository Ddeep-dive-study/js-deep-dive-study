## 변수의 생명 주기

**1️⃣ 지역 변수**

- 함수 내부 변수는 함수 호출 시 생성 → 함수 종료 시 소멸
    - 함수의 생명 주기 == 지역 변수의 생명 주기
    
- 지역 변수가 등록되어있는 스코프가 메모리에서 해제될 때까지 유효함
    - 아무도 그 메모리 공간을 참조하지 않으면 가비지 콜렉터에 의해 해제되어 가용 메모리 풀에 반환됨
    - 누군가 참조하고 있으면 해제되지 않음
    - 스코프도 동일함 → 함수 종료 시 함수가 생성한 스코프도 소멸함. 근데 누군가 스코프를 참조하고 있으면 해제X
    
- 호이스팅의 경우 스코프 단위로 동작함
    - 함수 호출 시 지역 변수 호이스팅 발생
    
    ```jsx
    var x = '전역'
    
    function f1() {
    	console.log(x) //undefined 출력 : 지역변수 x의 호이스팅이 일어남 
    	var x = '지역' //여기서 x에 값이 할당됨
    }
    
    f1()
    console.log(x) //'전역' 출력
    ```
    

**2️⃣ 전역 변수**

- 마지막 문이 실행되어 더이상 실행할 문이 없을 때 종료
- var키워드로 선언한 전역 변수는 전역객체의 프로퍼티가 됨
    
    <aside>
    💡 전역 객체란?
    
    - 자바스크립트는 소스 코드를 실행하기 전에 최상위에 한 개의 전역 객체를 생성한다.
    
    - 전역 객체의 이름은 환경에 따라 달라질 수 있음
    
        ex. 웹브라우저의 전역 객체 : window
    
        서버 사이드 환경에서의 전역 객체 : global 객체
    
    - 전역객체 프로퍼티
    
    - 표준 빌트인 객체(Object, String, Number, Function, Array, ..)
    - Web API(BOM, DOM, fetch, Canvas, SVG, Web Storage, Web Worker 등)
    - Node.js의 호스트API
    - var 키워드로 선언한 전역 변수와 전역 함수
    </aside>
    
    ⇒ 전역 변수의 생명 주기 = 전역 객체의 생명 주기
    

## 전역 변수의 문제점

**1️⃣ 암묵적 결합**

변수의 유효범위⬆️ : 모든 코드가 전역 변수를 참조하고 변경할 수 있음 

**2️⃣ 긴 생명 주기 & 리소스 장기간 소비**

의도치 않은 재할당으로 인해서 상태 변경에 의한 오류가 발생할 확률이 높음

**3️⃣ 스코프 체인 종점** **→ 가장 마지막에 검색됨**

중첩되있을 때 스코프를 계속 타고가야하므로 전역변수의 검색 속도가 가장 느리다

**4️⃣ 네임스페이스 오염**

※ 자바 스크립트는 파일이 분리되어 있더라도 하나의 전역 스코프를 공유함 

- 브라우저 환경의 모든 자바스크립트 코드는 하나의 전역객체 window 를 공유
- 여러 개의 script 태그로 분리해도, 다양한 모듈을 사용해도 하나의 전역객체 window 를 공유하는 것임

⇒ 다른 파일 내에서 동일한 이름을 가지는 전역 변수나 전역 함수가 같은 스코프 내에 존재할 경우 오류 발생 위험

**결론 : 전역 변수를 꼭 써야할 경우가 아니라면 지역 변수를 쓰자!**

## 전역 변수 사용 억제하기

### 1. 즉시 실행 함수

- 함수 정의와 동시에 호출되고, 단 한번만 호출됨
- 함수 내 모든 변수는 지역 변수가 됨

### 2. 네임스페이스 객체

- 전역에 객체를 생성해서 전역변수처럼 쓸 애를 프로퍼티로 추가

 

### 3. 모듈 패턴

- 클래스처럼 변수나 함수들을 모아서 즉시 실행 함수로 감싸서 하나의 모듈을 만들기
- 클로저 기반으로 동작
- 캡슐화 & 정보은닉 O
    
    <aside>
    💡 캡슐화란?
    
    - 객체의 프로퍼티와 메서드를 하나로 묶는 것
    - 외부로부터 접근할 수 없게 감출 목적으로 사용하는 경우 → 정보 은닉
    
    </aside>
    
    ```jsx
    var myModule = (function() {
      var privateVariable = 'private';
    
      function privateFunction() {
        console.log(privateVariable);
      }
    
      return {
        publicFunction: function() {
          privateFunction();
        }
      };
    })();
    
    myModule.publicFunction(); // 'private'
    console.log(myModule.privateVariable) //엥 이거는 근데 왜 undefined지?
    -> 객체 내에 없는 속성을 참조하려고 하면 undefined가 출력되기 때문에
    myModule.privateFunction(); //TypeError: 객체 내에 없는 메서드는 아예 에러가 뜸
    ```
    
    - 반환하는 객체의 프로퍼티 = public 멤버 : 외부에서 접근 가능
    - 반환하지 않는 프로퍼티 = private 멤버 : 외부에서 접근 불가

- ES6 모듈 사용
    - type="module" 어트리뷰트 추가
    - 전역변수 사용 불가 → var 키워드로 선언한 변수는 전역변수도 아니고 window객체의 프로퍼티도 아니게 됨

```jsx
<script type="module" src="파일.mjs"></script>
```